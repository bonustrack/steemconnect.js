<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SteemConnect example with Vue.js</title>
  <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
  <script src="https://unpkg.com/marked@0.3.6"></script>
  <script src="https://unpkg.com/lodash@4.16.0"></script>
  <script src="../dist/steemconnect.min.js"></script>
</head>
<body>

<div id="main" v-cloak>
  <div v-if="loading">
    Loading...
  </div>
  <div v-else>
    <button v-if="!username" @click="login">
      Log in
    </button>
    <div v-if="username">
      <p>
        You are logged as <b>{{username}}</b>
        <a href="#" @click="logout">logout</a>
      </p>
      <input v-model="input" placeholder="Write a comment"/>
      <button @click="comment">
        Submit
      </button>
      <p>
        <em>
          You are commenting on the post
          <a href="https://steemit.com/@siol/test" target="_blank">
            @siol/test
          </a>
        </em>
      </p>
    </div>
    <div v-if="txId">
      <p>
        The transaction has been broadcasted, here is the tx id:
        <a :href="'https://steemd.com/tx/' + txId" target="_blank">
          <b>{{txId}}</b>
        </a>
      </p>
    </div>
  </div>
</div>

<script type="text/javascript">
const sc = steemconnect.Initialize({
  app: 'busy.app',
  callbackURL: 'http://localhost:3000/callback'
});

window.onload = function() {
  new Vue({
    el: '#main',
    data: {
      username: null,
      input: null,
      loading: false,
      txId: null,
      error: null
    },
    methods: {
      login: function () {
        const self = this;
        this.loading = true;
        sc.login({}, function(err, token) {
          sc.setAccessToken(token);
          sc.me(function(err, result) {
            if (result) self.username = result.name;
            if (err) self.error = err;
            self.loading = false;
            console.log(err, result);
          });
        });
      },
      comment: function () {
        const self = this;
        this.loading = true;
        const permlink = 'steemconnect-' + new Date().getTime();
        sc.comment('siol', 'test', this.username, permlink, '', this.input, '', function(err, result) {
          self.loading = false;
          if (result) self.txId = result.id;
          if (err) self.error = err;
          console.log(err, result);
        });
      },
      logout: function () {
        this.username = null;
      }
    }
  });
};
</script>

<style type="text/css">
html, body {
  margin: 0;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  color: #333;
  background-color: #050036;
}

#main {
  background-color: white;
  height: 100%;
  padding: 15px;
  max-width: 600px;
  margin: 20px auto;
}

button {
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  color: white;
  background-color: #1500ff;
  padding: 12px 16px;
  border-radius: 6px;
  border: none;
  height: 48px;
}

input {
  cursor: pointer;
  font-size: 16px;
  padding: 11px 15px;
  border-radius: 6px;
  border: 1px solid #CCC;
  height: 24px;
}

[v-cloak] {
  display: none;
}

* {
  outline: none;
}
</style>

</body>
</html>
